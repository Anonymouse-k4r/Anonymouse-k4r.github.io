<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Donut + Funkytown</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      color: #ebcb8b;
      font-family: monospace;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    pre {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    audio {
      display: none;
    }
  </style>
</head>
<body>
  <pre id="d"></pre>
  <audio id="music" src="./funkytown.mp3" autoplay loop></audio>
  <script>
    const d = document.getElementById("d");
    let p = 0, q = 0;
    function frame() {
      const b = [], z = [];
      const ct = Math.cos(p += 0.07), st = Math.sin(p);
      const cp = Math.cos(q += 0.03), sp = Math.sin(q);
      for (let k = 0; k < 1760; k++) b[k] = k % 80 === 79 ? "\n" : " ", z[k] = 0;
      for (let j = 0; j < 6.28; j += 0.07) {
        const ctj = Math.cos(j), stj = Math.sin(j);
        for (let i = 0; i < 6.28; i += 0.02) {
          const si = Math.sin(i), ci = Math.cos(i);
          const x = ctj + 2, y = si * x, z0 = stj;
          const zz = y * st + z0 * ct + 5;
          const D = 1 / zz;
          const t = y * ct - z0 * st;
          const x2 = 0 | (40 + 30 * D * (ci * x * cp - t * sp));
          const y2 = 0 | (12 + 15 * D * (ci * x * sp + t * cp));
          const o = x2 + 80 * y2;
          const N = 0 | 8 * ((z0 * st - si * ctj * ct) * cp - si * ctj * st - z0 * ct - ci * ctj * sp);
          if (y2 < 22 && y2 >= 0 && x2 >= 0 && x2 < 79 && D > z[o]) {
            z[o] = D;
            b[o] = ".,~:;=!*#$@"[N > 0 ? N : 0];
          }
        }
      }
      d.innerHTML = b.join("");
    }
    setInterval(frame, 50);
  </script>
</body>
</html>
